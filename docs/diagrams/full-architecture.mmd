graph TB
    subgraph "å…§å®¹ç”Ÿç”¢å±¤ (æœ¬åœ°æ©Ÿå™¨/å°ˆç”¨ä¼ºæœå™¨)"
        A1[ç”Ÿç”¢æ©Ÿ - Storytelling<br/>storytelling-backend/run.sh]
        A2[ç”Ÿç”¢æ©Ÿ - Podcast<br/>gemini-2-podcast/]

        A1_1[Step 1: ç”Ÿæˆè…³æœ¬<br/>generate_script.py<br/>Gemini 2.5 Pro]
        A1_2[Step 2: ç”ŸæˆéŸ³é »<br/>generate_audio.py<br/>Gemini TTS]
        A1_3[Step 3: ç”Ÿæˆå­—å¹•<br/>generate_subtitles.py<br/>MFA è©ç´šå°é½Š]

        A1 --> A1_1 --> A1_2 --> A1_3

        OUTPUT[output/<br/>foundation/chapter0/<br/>â”œâ”€ podcast_script.txt<br/>â”œâ”€ podcast.wav/mp3<br/>â”œâ”€ subtitles.srt<br/>â””â”€ metadata.json]

        A1_3 --> OUTPUT
        A2 --> |import_gemini_dialogue.py| OUTPUT
    end

    subgraph "é›²ç«¯å„²å­˜å±¤"
        GCS[Google Cloud Storage<br/>gs://storytelling-output/output/<br/><br/>ğŸ“¦ åƒ…å­˜ .json metadata<br/>ğŸµ éŸ³è¨Š .mp3<br/>ğŸ“ å­—å¹• .srt]
    end

    subgraph "API æœå‹™å±¤ (Render Deployment)"
        B[FastAPI Server<br/>storytelling-backend/server/<br/><br/>ğŸ”¹ ä¸ç”Ÿæˆå…§å®¹<br/>ğŸ”¹ æƒæ output/ æˆ– GCS<br/>ğŸ”¹ å»ºç«‹æ›¸ç±/ç« ç¯€ç´¢å¼•]

        B1[GCSMirror<br/>åŒæ­¥ .json åˆ°æœ¬åœ°<br/>/tmp/storytelling-output]
        B2[OutputDataCache<br/>è§£æ metadata.json<br/>å»ºç«‹ API ç´¢å¼•]

        B --> B1 --> B2
    end

    subgraph "å‰ç«¯æ¶ˆè²»å±¤"
        C[iOS App<br/>audio-earning-ios<br/><br/>SwiftUI + MVVM]

        C1[ğŸ“š æ›¸ç±/ç« ç¯€ç€è¦½<br/>6h å¿«å– TTL]
        C2[ğŸ§ æ’­æ”¾å™¨<br/>AVPlayer + æ³¢å½¢]
        C3[ğŸ“ å­—å¹•ç¿»è­¯<br/>è©ç´šé«˜äº®]
        C4[ğŸ’¾ æ‰¹æ¬¡ä¸‹è¼‰<br/>é›¢ç·šä½¿ç”¨]

        C --> C1
        C --> C2
        C --> C3
        C --> C4
    end

    OUTPUT -.->|sync_output.sh<br/>rsync ä¸Šå‚³| GCS
    GCS -.->|å†·å•Ÿå‹•åŒæ­¥<br/>åƒ…ä¸‹è¼‰ .json| B1

    B2 -->|REST API<br/>/books<br/>/chapters<br/>/audio âœ 307<br/>/subtitles âœ 307| C

    GCS -.->|307 è½‰å€<br/>å…¬é–‹ URL<br/>gcs-public mode| C

    style A1 fill:#e3f2fd
    style A2 fill:#e3f2fd
    style OUTPUT fill:#fff9c4
    style GCS fill:#f3e5f5
    style B fill:#fff3e0
    style C fill:#e8f5e9
